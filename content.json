{"pages":[{"title":"categories","text":"","link":"/categories/index.html"}],"posts":[{"title":"Hello World","text":"Welcome to","link":"/2020/01/13/hello-word/"},{"title":"Hello World","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public WebApplicationContext initWebApplicationContext(ServletContext servletContext) { //保证只有一个WebApplicationContext //从ServletContext查找WebApplicationContext实例,如果已经存在,则抛出异常 //典型异常:在web.xml中配置了不止一个ContextLoaderListener,造成多次初始化 if (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != null) { throw new IllegalStateException(&quot;Cannot initialize context because there is already a root application context present - check whether you have multiple ContextLoader* definitions in your web.xml!&quot;); } else { servletContext.log(&quot;Initializing Spring root WebApplicationContext&quot;); Log logger = LogFactory.getLog(ContextLoader.class); if (logger.isInfoEnabled()) { logger.info(&quot;Root WebApplicationContext: initialization started&quot;); } long startTime = System.currentTimeMillis(); try { if (this.context == null) { //创建WebApplicationContext实例,其实这里创建的是它的子类ConfigurableWebApplicationContext this.context = this.createWebApplicationContext(servletContext); } if (this.context instanceof ConfigurableWebApplicationContext) { ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext)this.context; if (!cwac.isActive()) { if (cwac.getParent() == null) { ApplicationContext parent = this.loadParentContext(servletContext); cwac.setParent(parent); } this.configureAndRefreshWebApplicationContext(cwac, servletContext); } } servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, this.context); ClassLoader ccl = Thread.currentThread().getContextClassLoader(); if (ccl == ContextLoader.class.getClassLoader()) { currentContext = this.context; } else if (ccl != null) { currentContextPerThread.put(ccl, this.context); } if (logger.isInfoEnabled()) { long elapsedTime = System.currentTimeMillis() - startTime; logger.info(&quot;Root WebApplicationContext initialized in &quot; + elapsedTime + &quot; ms&quot;); } return this.context; } catch (Error | RuntimeException var8) { logger.error(&quot;Context initialization failed&quot;, var8); servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, var8); throw var8; } }}","link":"/2020/01/15/spring/101/"}],"tags":[],"categories":[{"name":"java","slug":"java","link":"/categories/java/"},{"name":"spring","slug":"spring","link":"/categories/spring/"}]}